<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>portloop.xyz - half baked thoughts</title>
<style>
@font-face {
  font-family: 'Fixedsys';
  src: url('FSEX302.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
  width: 100%; height: 100%;
  background: #008080;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
  font-family: "Microsoft Sans Serif", "Tahoma", "Arial", sans-serif;
  font-size: 11px;
  user-select: auto;
  -webkit-font-smoothing: none;
}

/* ── Window Frame ── */
.win95-window {
  position: relative;
  width: 60%;
  height: 60%;
  min-width: 420px;
  min-height: 320px;
  background: #c0c0c0;
  display: flex;
  flex-direction: column;
  padding: 3px;
  box-shadow:
    inset -1px -1px 0 #000000,
    inset 1px 1px 0 #ffffff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
}

/* ── Ouroboros ── */
.ouroboros {
  position: absolute;
  bottom: 100%;
  left: 3%;
  width: 72px;
  height: 42px;
  pointer-events: none;
  overflow: visible;
}

/* ── Title Bar ── */
.title-bar {
  background: linear-gradient(90deg, #000080, #1084d0);
  padding: 2px 2px 2px 3px;
  display: flex;
  align-items: center;
  gap: 3px;
  flex-shrink: 0;
  height: 20px;
}

.title-bar-icon {
  width: 16px; height: 16px;
  flex-shrink: 0;
  image-rendering: pixelated;
}

.title-bar-text {
  color: #ffffff;
  font-weight: normal;
  font-size: 16px;
  font-family: 'Fixedsys', 'Fixedsys Excelsior 3.01', 'Terminal', 'Courier New', monospace;
  flex: 1;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  padding-top: 1px;
}

.title-bar-controls {
  display: flex;
  gap: 2px;
  flex-shrink: 0;
}

.title-btn {
  width: 16px; height: 14px;
  background: #c0c0c0;
  border: none;
  font-size: 10px;
  font-family: inherit;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: default;
  padding: 0;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
}
.title-btn:active {
  box-shadow:
    inset 1px 1px 0 #000,
    inset -1px -1px 0 #fff,
    inset 2px 2px 0 #808080;
  padding: 1px 0 0 1px;
}

/* ── Menu Bar ── */
.menu-bar {
  display: flex;
  flex-shrink: 0;
  height: 18px;
  align-items: stretch;
  border-bottom: 1px solid #808080;
}

.menu-item {
  padding: 1px 8px 0;
  cursor: default;
  font-size: 11px;
  color: #000;
  display: flex;
  align-items: center;
}
.menu-item:hover {
  background: #000080;
  color: #fff;
}
.menu-item u { text-decoration: underline; }
.menu-item.active {
  background: #000080;
  color: #fff;
}

/* ── Dropdown Menu ── */
.menu-dropdown {
  position: absolute;
  top: 100%;
  left: 0;
  background: #c0c0c0;
  min-width: 160px;
  padding: 2px;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
  z-index: 1000;
  display: none;
}
.menu-dropdown.open { display: block; }
.menu-dropdown-item {
  padding: 3px 24px 3px 24px;
  cursor: default;
  font-size: 11px;
  white-space: nowrap;
}
.menu-dropdown-item:hover {
  background: #000080;
  color: #fff;
}

/* ── About Dialog Overlay ── */
.dialog-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}

/* ── About Dialog ── */
.about-dialog {
  width: 420px;
  background: #c0c0c0;
  padding: 3px;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
  font-family: "Microsoft Sans Serif", "Tahoma", "Arial", sans-serif;
  font-size: 11px;
}

.about-title-bar {
  background: linear-gradient(90deg, #000080, #1084d0);
  padding: 2px 2px 2px 3px;
  display: flex;
  align-items: center;
  gap: 3px;
  height: 20px;
  margin-bottom: 0;
}
.about-title-bar .title-bar-text {
  font-size: 16px;
}

.about-body {
  padding: 16px 12px 8px;
  display: flex;
  gap: 16px;
}

.about-icon {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
}

.about-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.about-info p {
  margin: 0;
  font-size: 11px;
  line-height: 1.5;
}

.about-info .about-license {
  margin-top: 12px;
}

.about-info .about-separator {
  height: 1px;
  border: none;
  border-top: 1px solid #808080;
  border-bottom: 1px solid #fff;
  margin: 8px 0;
}

.about-info .about-system {
  font-size: 11px;
}

.about-footer {
  display: flex;
  justify-content: flex-end;
  padding: 4px 12px 12px;
}

.about-ok-btn {
  width: 80px;
  height: 23px;
  background: #c0c0c0;
  border: none;
  font-family: "Microsoft Sans Serif", "Tahoma", "Arial", sans-serif;
  font-size: 11px;
  cursor: default;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
  outline: 1px dotted #000;
  outline-offset: -4px;
}
.about-ok-btn:active {
  box-shadow:
    inset 1px 1px 0 #000,
    inset -1px -1px 0 #fff,
    inset 2px 2px 0 #808080;
  padding: 1px 0 0 1px;
}

/* ── Content Area ── */
.content-frame {
  flex: 1;
  margin: 2px 0;
  overflow: hidden;
  box-shadow:
    inset 1px 1px 0 #808080,
    inset -1px -1px 0 #dfdfdf,
    inset 2px 2px 0 #000,
    inset -2px -2px 0 #fff;
}

.content {
  width: 100%;
  height: 100%;
  background: #fff;
  overflow-y: auto;
  padding: 2px 4px;
  font-family: 'Fixedsys', 'Fixedsys Excelsior 3.01', 'Terminal', 'Courier New', monospace;
  font-size: 16px;
  line-height: 1.4;
  color: #000;
  cursor: default;
  outline: none;
}

/* Win95 scrollbar */
.content::-webkit-scrollbar { width: 16px; }
.content::-webkit-scrollbar-track {
  background: repeating-conic-gradient(#c0c0c0 0% 25%, #fff 0% 50%) 50% / 2px 2px;
}
.content::-webkit-scrollbar-thumb {
  background: #c0c0c0;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
}
.content::-webkit-scrollbar-button:single-button {
  background: #c0c0c0;
  display: block;
  height: 16px;
  box-shadow:
    inset -1px -1px 0 #000,
    inset 1px 1px 0 #fff,
    inset -2px -2px 0 #808080,
    inset 2px 2px 0 #dfdfdf;
}

/* ── Article List ── */
.article-line {
  padding: 1px 4px;
  white-space: normal;
  cursor: default;
}
.article-line:hover:not(.selected) {
  background: rgba(0, 0, 128, 0.08);
}
.article-line.selected {
  background: #000080;
  color: #fff;
}

/* ── Article View ── */
.back-hint {
  padding: 2px 4px 6px;
  cursor: pointer;
  color: #a0a0a0;
}

.article-heading {
  padding: 0 4px 2px;
}

.article-rule {
  padding: 0 4px 6px;
  color: #a0a0a0;
}

.article-body {
  padding: 0 4px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* ── Mobile Responsive ── */
@media (max-width: 600px) {
  html, body {
    align-items: stretch;
    justify-content: stretch;
  }

  .win95-window {
    width: 100%;
    height: 100%;
    min-width: 0;
    min-height: 0;
  }

  .ouroboros {
    display: none;
  }

  .title-bar {
    height: 28px;
    padding: 2px 4px;
  }

  .title-bar-icon {
    width: 18px;
    height: 18px;
  }

  .title-btn {
    width: 24px;
    height: 22px;
  }

  .menu-bar {
    height: 28px;
  }

  .menu-item {
    padding: 2px 10px;
    font-size: 13px;
  }

  .menu-dropdown-item {
    padding: 8px 24px;
    font-size: 13px;
  }

  .content {
    font-size: 15px;
    padding: 4px 6px;
  }

  .article-line {
    padding: 6px 6px;
  }

  .back-hint {
    padding: 8px 6px 10px;
    font-size: 15px;
  }

  .article-heading {
    padding: 0 6px 4px;
  }

  .article-rule {
    padding: 0 6px 8px;
  }

  .article-body {
    padding: 0 6px;
  }

  .about-dialog {
    width: calc(100vw - 16px);
    max-width: 420px;
  }

  .about-ok-btn {
    width: 88px;
    height: 28px;
    font-size: 13px;
  }
}
</style>
</head>
<body>

<div class="win95-window">

  <!-- Ouroboros – infinity snake (portloop) -->
  <svg class="ouroboros" viewBox="0 0 48 28" fill="none" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <path id="inf" d="M 24,14 C 30,3 43,3 43,14 C 43,25 30,25 24,14 C 18,3 5,3 5,14 C 5,25 18,25 24,14"/>
    </defs>
    <!-- body -->
    <use href="#inf" stroke="#2e7d32" stroke-width="5.5" fill="none" stroke-linejoin="round"/>
    <!-- belly stripe -->
    <use href="#inf" stroke="#6abf69" stroke-width="2" fill="none"/>
    <!-- scale flow -->
    <use href="#inf" stroke="#1b5e20" stroke-width="1.2" fill="none" stroke-dasharray="2.5 3.5" stroke-linecap="butt">
      <animate attributeName="stroke-dashoffset" from="0" to="-60" dur="4s" repeatCount="indefinite"/>
    </use>
    <!-- head at right apex -->
    <rect x="39" y="9" width="8" height="10" fill="#2e7d32"/>
    <rect x="40" y="10" width="6" height="8" fill="#3a9e3a"/>
    <!-- eyes -->
    <rect x="41" y="11" width="2" height="2" fill="#e8e82e"/>
    <rect x="44" y="11" width="2" height="2" fill="#e8e82e"/>
    <rect x="41" y="11" width="1" height="1" fill="#111"/>
    <rect x="45" y="11" width="1" height="1" fill="#111"/>
    <!-- nostrils -->
    <rect x="42" y="14" width="1" height="1" fill="#1b5e20"/>
    <rect x="44" y="14" width="1" height="1" fill="#1b5e20"/>
    <!-- top of head highlight -->
    <rect x="41" y="9" width="4" height="1" fill="#4caf50"/>
  </svg>

  <!-- Title Bar -->
  <div class="title-bar">
    <svg class="title-bar-icon" viewBox="0 0 16 16" fill="none">
      <rect x="4" y="1" width="10" height="14" fill="#ffffc0" stroke="#808080" stroke-width=".6"/>
      <rect x="2" y="0" width="3" height="16" fill="#8080c0" stroke="#000080" stroke-width=".4"/>
      <line x1="6" y1="5" x2="13" y2="5" stroke="#000080" stroke-width=".7"/>
      <line x1="6" y1="8" x2="13" y2="8" stroke="#000080" stroke-width=".7"/>
      <line x1="6" y1="11" x2="11" y2="11" stroke="#000080" stroke-width=".7"/>
    </svg>
    <span class="title-bar-text">portloop.xyz - half baked thoughts</span>
    <div class="title-bar-controls">
      <button class="title-btn" aria-label="Minimize"><span style="font-weight:bold;font-size:11px;margin-top:3px">_</span></button>
      <button class="title-btn" aria-label="Maximize"><span style="font-size:9px">◻</span></button>
      <button class="title-btn" aria-label="Close"><span style="font-weight:bold;font-size:11px">×</span></button>
    </div>
  </div>

  <!-- Menu Bar -->
  <div class="menu-bar">
    <span class="menu-item" id="menu-file" style="position:relative"><u>F</u>ile
      <div class="menu-dropdown" id="file-dropdown">
        <div class="menu-dropdown-item" id="menu-about"><u>A</u>bout</div>
      </div>
    </span>
    <span class="menu-item"><u>E</u>dit</span>
    <span class="menu-item"><u>S</u>earch</span>
    <span class="menu-item"><u>H</u>elp</span>
  </div>

  <!-- Content -->
  <div class="content-frame">
    <div class="content" id="content" tabindex="0"></div>
  </div>


</div>

<script>
let articles = [];
let sel = 0;
let view = 'list';
let indexText = '';
const contentEl = document.getElementById('content');

function formatTitle(a) {
  let t = '';
  if (a.date) {
    const [y, m, d] = a.date.split('-');
    t += d + '.' + m + '.' + y + ' - ';
  }
  t += a.title;
  if (a.tag) t += ' // ' + a.tag;
  return t;
}

async function loadArticles() {
  try {
    const [artRes, idxRes] = await Promise.all([
      fetch('articles.json'),
      fetch('index.md')
    ]);
    const data = await artRes.json();
    data.sort((a, b) => (b.date || '').localeCompare(a.date || ''));
    articles = data.map(a => ({
      title: formatTitle(a),
      body: a.body
    }));
    if (idxRes.ok) indexText = (await idxRes.text()).trim();
  } catch (e) {
    articles = [{ title: 'no articles yet', body: 'check back later.' }];
  }
  sel = 0;
  showList();
}

function showList() {
  view = 'list';
  contentEl.innerHTML = '';
  if (indexText) {
    const intro = document.createElement('div');
    intro.className = 'article-line';
    intro.textContent = indexText;
    contentEl.appendChild(intro);
    const spacer = document.createElement('div');
    spacer.className = 'article-line';
    spacer.innerHTML = '&nbsp;';
    contentEl.appendChild(spacer);
  }
  const isMobile = window.matchMedia('(max-width: 600px)').matches;
  articles.forEach((a, i) => {
    const el = document.createElement('div');
    el.className = 'article-line' + (i === sel ? ' selected' : '');
    el.textContent = a.title;
    if (isMobile) {
      el.addEventListener('click', () => { sel = i; openArticle(); });
    } else {
      el.addEventListener('click', () => { sel = i; showList(); });
      el.addEventListener('dblclick', () => { sel = i; openArticle(); });
    }
    contentEl.appendChild(el);
  });
}

function openArticle() {
  view = 'article';
  const a = articles[sel];
  contentEl.innerHTML = '';

  const back = document.createElement('div');
  back.className = 'back-hint';
  back.textContent = '← back [ESC]';
  back.addEventListener('click', showList);
  contentEl.appendChild(back);

  const h = document.createElement('div');
  h.className = 'article-heading';
  h.textContent = a.title;
  contentEl.appendChild(h);

  const rule = document.createElement('div');
  rule.className = 'article-rule';
  rule.textContent = '─'.repeat(36);
  contentEl.appendChild(rule);

  const body = document.createElement('div');
  body.className = 'article-body';
  body.textContent = a.body;
  contentEl.appendChild(body);

  contentEl.scrollTop = 0;
}

document.addEventListener('keydown', e => {
  if (view === 'list') {
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      if (sel < articles.length - 1) { sel++; showList(); }
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      if (sel > 0) { sel--; showList(); }
    } else if (e.key === 'Enter') {
      e.preventDefault();
      openArticle();
    }
  } else {
    if (e.key === 'Escape' || e.key === 'Backspace') {
      e.preventDefault();
      showList();
    }
  }
});

loadArticles();

// ── File Menu Dropdown ──
const menuFile = document.getElementById('menu-file');
const fileDropdown = document.getElementById('file-dropdown');
const menuAbout = document.getElementById('menu-about');

menuFile.addEventListener('click', (e) => {
  e.stopPropagation();
  const isOpen = fileDropdown.classList.contains('open');
  closeDropdown();
  if (!isOpen) {
    fileDropdown.classList.add('open');
    menuFile.classList.add('active');
  }
});

function closeDropdown() {
  fileDropdown.classList.remove('open');
  menuFile.classList.remove('active');
}

document.addEventListener('click', () => {
  closeDropdown();
});

// ── About Dialog ──
menuAbout.addEventListener('click', (e) => {
  e.stopPropagation();
  closeDropdown();
  openAboutDialog();
});

async function openAboutDialog() {
  let lines = [];
  try {
    const res = await fetch('file/about/index.md');
    const text = await res.text();
    lines = text.split('\n');
  } catch (e) {
    lines = ['About Notepad'];
  }

  // Parse the md content into sections
  const product = lines.slice(0, 3).join('\n');
  const license = lines.slice(4, 7).join('\n');
  const system = lines.slice(8).filter(l => l.trim()).join('\n');

  const overlay = document.createElement('div');
  overlay.className = 'dialog-overlay';

  overlay.innerHTML = `
    <div class="about-dialog">
      <div class="about-title-bar">
        <span class="title-bar-text">About Notepad</span>
        <div class="title-bar-controls">
          <button class="title-btn about-close-btn" aria-label="Close"><span style="font-weight:bold;font-size:11px">×</span></button>
        </div>
      </div>
      <div class="about-body">
        <svg class="about-icon" viewBox="0 0 48 48" fill="none">
          <rect x="10" y="2" width="32" height="44" fill="#ffffc0" stroke="#808080" stroke-width="1.5"/>
          <rect x="4" y="0" width="10" height="48" fill="#8080c0" stroke="#000080" stroke-width="1"/>
          <line x1="16" y1="14" x2="38" y2="14" stroke="#000080" stroke-width="1.5"/>
          <line x1="16" y1="22" x2="38" y2="22" stroke="#000080" stroke-width="1.5"/>
          <line x1="16" y1="30" x2="32" y2="30" stroke="#000080" stroke-width="1.5"/>
        </svg>
        <div class="about-info">
          <p style="white-space:pre-line">${product}</p>
          <p class="about-license" style="white-space:pre-line">${license}</p>
          <hr class="about-separator">
          <p class="about-system" style="white-space:pre-line">${system}</p>
        </div>
      </div>
      <div class="about-footer">
        <button class="about-ok-btn">OK</button>
      </div>
    </div>
  `;

  document.body.appendChild(overlay);

  const closeDialog = () => overlay.remove();
  overlay.querySelector('.about-ok-btn').addEventListener('click', closeDialog);
  overlay.querySelector('.about-close-btn').addEventListener('click', closeDialog);
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay) closeDialog();
  });

  const escHandler = (e) => {
    if (e.key === 'Escape') {
      e.preventDefault();
      e.stopPropagation();
      closeDialog();
      document.removeEventListener('keydown', escHandler, true);
    }
  };
  document.addEventListener('keydown', escHandler, true);
}
</script>

</body>
</html>
